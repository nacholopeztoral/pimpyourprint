<div class="container">
  <div class=" row flex-events-box">
    <div class="user-box ">
      <div>
        <%= image_tag current_user.avatar.url,  class: "avatar-events" %>
        <p><%= current_user.username %></p>
        <%= link_to "Create Event", new_event_path, class: 'event-link' %>
        <p>Future events:</p>
        <p><% current_user.attendances.each do |attendance| %></p>
        <a href="#" class= "thePopup" onclick="javascript:showPopup()" ><%= attendance.event.title %></a>
        <div id="myPopup" class="popup-content">
          <p><%= attendance.event.end_date %></p>
          <p><%= attendance.event.description %></p>
          <p><%= attendance.event.address %></p>
          <%= link_to event_attendance_path(attendance.event, attendance.id), :method => 'delete' , class: 'event-link' do %>
          <i class="fas fa-trash-alt"></i>
          <% end  %>
        </div>
        <% end  %>
      </div>
    </div>
    <div class="event-card-container">
  <%= form_tag events_path, method: :get do %>
    <%= text_field_tag :query,
      params[:query],
      placeholder: "Search events by city",
      class: "events-search-input",
      id: "address-input"
    %>
    <%= submit_tag "Search", class: "btn btn-secondary" %>
  <% end %>
      <div class=" row ">
        <% @events.each do |event| %>
        <div class="events-box">
          <div style="display: flex; justify-content: end;">
            <%= image_tag current_user.avatar.url,  class: "avatar-event-creator" %>
            <h4 class="title-event">" <%= event.title %> "</h4>
          </div>
          <p>Created by <%= event.user.username %></p>
          <div class="injection">
            <p>Description: <%= event.description %></p>
            <p>Description: <%= event.address %></p>
            <p >Capacity of <%= event.capacity %> people</p>
          </div>
          <div class="event-links">
            <%= link_to "Comment", new_event_comment_path(event.id), class: 'event-link ' %>
            <div class="event-link grow">Read more</div>
            <%= link_to "Join", event_attendances_path(event.id), method: :post, class: 'event-link' %>
          </div>
        </div>
        <% end %>
      </div>

    </div>
  </div>
</div>

<script>
  // initializing Algolia Places


  function showPopup() {
        // event.preventDefault();
        document.getElementById("myPopup").classList.toggle("show");
        return false;
      }

    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
      if (!event.target.matches('.thePopup')) {

        var dropdowns = document.getElementsByClassName("popup-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }
  </script>
  <%= javascript_pack_tag 'events' %>
